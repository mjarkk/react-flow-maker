import t from"react";import e from"js-sha1";function n(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,o(t,e)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var a=function(){function t(){this.conf={components:{},introComponents:[]},this.errors=[]}var e=t.prototype;return e.title=function(t){return this.conf.components[t].title},e.get=function(){return this.conf},e.parseNewLogic=function(t){var e=[],n=function(){var t,n=[].slice.call(arguments);e.push(n.join(" ")),(t=console).log.apply(t,["logic parse warning:"].concat(n))},o={components:{},introComponents:[]};return t.components&&(Array.isArray(t.components)?(t.components.map(function(t,e){if(t.name&&t.title){var i=[],a={name:t.name,title:t.title,next:t.next?Array.isArray(t.next)?t.next:[t.next]:[],tooltip:t.tooltip,inputs:[],advancedInputs:[]};Array.isArray(t.inputs)&&t.inputs.map(function(t,o){if(t.title&&t.name&&t.type)if("function"==typeof t.validation||void 0===t.validation)if("string"==typeof t.tooltip||void 0===t.tooltip)if(-1==i.indexOf(t.name)){var r={name:t.name,title:t.title,type:t.type,validation:t.validation,tooltip:t.tooltip,default:t.default};switch(t.type){case"text":"string"!=typeof t.default&&void 0!==t.default&&(n("logic.components["+e+"].inputs["+o+"].default must be a string or undefined, using default empty string"),r.default=""),null==t.default&&(r.default="");break;case"number":"number"!=typeof t.default&&void 0!==t.default&&(n("logic.components["+e+"].inputs["+o+"].default must be a number or undefined, using default 0"),r.default=0),null==t.default&&(r.default=0);break;case"switch":"boolean"!=typeof t.default&&void 0!==t.default&&(n("logic.components["+e+"].inputs["+o+"].default must be a boolean or undefined, using default empty string"),r.default=!1),null==t.default&&(r.default=!1);break;case"dropdown":if(!Array.isArray(t.options))return void n("logic.components["+e+"].inputs["+o+"].options is not defined or is not an array, skipping this item");r.options=t.options.map(function(t,i){if("string"==typeof t.title&&"string"==typeof t.value&&("string"==typeof t.tooltip||null==t.tooltip))return{title:t.title,tooltip:t.tooltip,value:t.value};n("logic.components["+e+"].inputs["+o+"].options["+i+"] does not have the correct items (title string, value string, tooltip string), skipping this item")}).filter(function(t){return t});break;default:return void n("logic.components["+e+"].inputs["+o+"].type = '"+t.type+"' is not valid, this input will be ignored")}i.push(t.name),a[t.advanced?"advancedInputs":"inputs"].push(r)}else n("logic.components["+e+"].inputs["+o+"].name can't be equal to other names");else n("logic.components["+e+"].inputs["+o+"].tooltip must be a string or not undefined");else n("logic.components["+e+"].inputs["+o+"].validation must be undefined or a function");else n("logic.components["+e+"].inputs["+o+"] does not have a name, type or title field, this input will be ignored")}),o.components[t.name]=a}else n("logic.components["+e+"] does not have a name or title field, this component will be ignored")}),Object.keys(o.components).map(function(t){o.components[t].next=o.components[t].next.filter(function(t){return!!o.components[t]||(n("logic.component[???].next contains '"+t+"' that does not exsist, this item will be ignored"),!1)})})):n("logic.components is not an array")),t.introComponents&&(Array.isArray(t.introComponents)?t.introComponents.map(function(t){o.components[t]?o.introComponents.push(t):n("logic.introComponents['"+t+"'] is not a known component")}):"string"==typeof t.introComponents?o.components[t.introComponents]?o.introComponents.push(t.introComponents):n("logic.introComponents = '"+name+"' is not a known component"):n("logic.introComponents is not an array or string")),this.errors=e,this.conf=o,o},t}(),r=function(){function t(t,e){this.Logic=t,this.FlowMaker=e,this.maxDepth=0,this.flow=[],this.exportBuzzy=!1,this.reExport=!1,this.exportFunc=void 0}var e=t.prototype;return e.setExportFunc=function(t){this.exportFunc=t},e.caclMaxDepth=function(){var t=this;this.maxDepth=0,function e(n){n.map(function(n){n.depth>t.maxDepth&&(t.maxDepth=n.depth),e(n.next)})}(this.flow),this.FlowMaker.forceUpdate()},e.flowItem=function(t,e,n){var o=function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<20;o++)e+=n.charAt(Math.floor(Math.random()*n.length));return e}();return{depth:n+1,next:[],id:o,path:[].concat(e,[o]),inputData:{},inputValidation:{},component:t}},e.startFlow=function(t){var e=this.Logic.conf.components[t];e&&(this.flow.push(this.flowItem(e,[],0)),this.caclMaxDepth(),this.export())},e.addComponent=function(t,e){var n=this.Logic.conf.components[t];if(n){var o=this.findPath(e);o.next.push(this.flowItem(n,o.path,o.depth)),this.caclMaxDepth(),this.export()}},e.findPath=function(t){var e=void 0;return function n(o){for(var i=0;i<o.length;i++){if(o[i].path===t){e=o[i];break}n(o[i].next)}}(this.flow),e},e.removeComponent=function(t){this.flow=function e(n){n=Object.assign([],n);for(var o=0;o<n.length;o++){if(n[o].path===t){n.splice(o,1);break}n[o].next=e(n[o].next)}return n}(this.flow),this.caclMaxDepth(),this.export()},e.export=function(){var t=this;this.exportBuzzy?this.reExport=!0:(this.exportBuzzy=!0,setTimeout(function(){if(t.reExport)return t.exportBuzzy=!1,t.reExport=!1,void t.export();var e=[];!function t(e,n){n.map(function(n){var o={},i={};Object.keys(n.inputData).map(function(t){o[t]=n.inputData[t].value,n.inputData[t].error&&(i[t]=n.inputData[t].error)}),e.push({component:{title:n.component.title,name:n.component.name},inputs:o,inputErrors:i,id:n.id,next:[]}),t(e[e.length-1].next,n.next)})}(e,t.flow),"function"==typeof t.exportFunc&&t.exportFunc(e),setTimeout(function(){t.exportBuzzy=!1,t.reExport&&(t.reExport=!1,t.export())},30)},50))},e.import=function(t){var e=this;if(Array.isArray(t)){var n=[];!function t(n,o,i){n.map(function(n){var a=e.flowItem(e.Logic.conf.components[n.component.name],i,i.length);a.id=n.id,a.inputData=Object.keys(n.inputs).reduce(function(t,e){return t[e]={value:n.inputs[e],error:""},t},{}),a.path.splice(-1,1),a.path.push(n.id),o.push(a),t(n.next,o[o.length-1].next,[].concat(i,[n.id]))})}(t,n,[]),this.flow=n,this.caclMaxDepth()}},e.updateInputValue=function(t,e,n,o){var i=this.findPath(t);i&&(o?i.component.advancedInputs&&i.component.advancedInputs[n]&&(i.inputData[i.component.advancedInputs[n].name]=e):i.component.inputs&&i.component.inputs[n]&&(i.inputData[i.component.inputs[n].name]=e)),this.export()},t}(),s=function(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},t.createElement("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),t.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}))},l=function(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},t.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),t.createElement("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v10zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z"}))},p=function(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},t.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),t.createElement("path",{d:"M8.71 11.71l2.59 2.59c.39.39 1.02.39 1.41 0l2.59-2.59c.63-.63.18-1.71-.71-1.71H9.41c-.89 0-1.33 1.08-.7 1.71z"}))},c=function(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},t.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),t.createElement("path",{d:"M8.71 12.29L11.3 9.7c.39-.39 1.02-.39 1.41 0l2.59 2.59c.63.63.18 1.71-.71 1.71H9.41c-.89 0-1.33-1.08-.7-1.71z"}))},u=function(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24"},t.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),t.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1zm1-8h-2V7h2v2z"}))},h=function(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},t.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}),t.createElement("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}))},d=function(){return t.createElement("svg",{className:"flow-alertIcon",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},t.createElement("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),t.createElement("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),t.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"17"}))},m=function(e){function o(){var t;return(t=e.call(this)||this).state={open:!1},t}n(o,e);var i=o.prototype;return i.clickRoundButton=function(){this.setState({open:!this.state.open})},i.clickOption=function(t){this.props.out(t),this.setState({open:!1})},i.render=function(){var e=this,n=this.props,o=this.state;return t.createElement("div",{className:"flow-addIcon"},t.createElement("div",{className:"flow-round "+(o.open?"flow-open":"flow-closed"),onClick:function(){return e.clickRoundButton()}},t.createElement(s,null)),t.createElement("div",{className:"flow-options "+(o.open?"flow-open":"flow-closed")},n.options?n.options.map(function(n,o){return t.createElement("div",{onClick:function(){return e.clickOption(n)},key:o,className:"flow-option"},e.props?e.props.Logic.title(n):n)}):""))},o}(t.Component),f=function(e){function o(){return e.apply(this,arguments)||this}return n(o,e),o.prototype.render=function(){return this.props.tip?t.createElement("div",{className:"flow-tooltip flow-transparrent"+(this.props.transparrent?"True":"False")},t.createElement("div",{className:"flow-icon"},t.createElement(u,null)),t.createElement("div",{className:"flow-noWidth"},t.createElement("div",{className:"flow-fullwidth"},t.createElement("div",{className:"flow-popup"},this.props.tip)))):""},o}(t.Component),v=function(e){function o(){var t;return(t=e.call(this)||this).refID="",t.state={value:"",error:"",dropDownSelected:-1,isAfterInit:!1,dropDownopen:!1},t}n(o,e);var i=o.prototype;return i.tellParent=function(){this.props.onChange&&this.props.onChange({error:this.state.error,value:this.state.value})},i.updateDefaultVal=function(){var t=this;if(this.props.input&&!this.state.isAfterInit||this.refID!=this.props.refID){this.refID=this.props.refID;var e=void 0!==this.props.initalVal?this.props.initalVal:this.props.input.default;this.setState({value:e,isAfterInit:!0},function(){t.validate(e,function(){if("dropdown"==t.props.input.type&&-1==t.state.dropDownSelected){var n=0;t.props.input.options.map(function(t,o){t.value==e&&(n=o)}),t.setState({dropDownSelected:n})}t.tellParent()})})}},i.validate=function(t,e){if("function"==typeof this.props.input.validation){var n=this.props.input.validation(void 0,t);"string"!=typeof n&&(n=""),this.setState({error:n},e)}"function"==typeof e&&e()},i.updateValue=function(t){var e=this;this.setState({value:t},function(){e.validate(t,function(){e.tellParent()})})},i.componentDidMount=function(){this.updateDefaultVal()},i.componentDidUpdate=function(){this.updateDefaultVal(),this.props.hiddenDropdown&&this.state.dropDownopen&&this.setState({dropDownopen:!1})},i.render=function(){var e,n=this,o=this.state.error,i=this.props.input;if(!i)return t.createElement("div",{className:"flow-input"});var a=function(){return t.createElement("div",{className:"flow-label",onClick:function(){return e?e.focus():"switch"==i.type?n.updateValue(!n.state.value):""}},t.createElement("span",null,i.title),t.createElement(f,{transparrent:!0,tip:i.tooltip}))};return t.createElement("div",{className:"flow-input flow-input-type-"+i.type+" flow-hasErr"+(o?"True":"False")},"switch"!=i.type?t.createElement(a,null):"",t.createElement("div",{className:"flow-actualInput"},"text"==i.type||"number"==i.type?t.createElement("div",{className:"flow-text"},t.createElement("input",{ref:function(t){return e=t},type:i.type,value:this.state.value,onChange:function(t){return n.updateValue(t.target.value)}})):"switch"==i.type?t.createElement("div",{className:"flow-switch"},t.createElement("div",{onClick:function(){return n.updateValue(!n.state.value)},className:"flow-actualSwitch "+(this.state.value?"flow-true":"flow-false")},t.createElement("div",{className:"flow-inside"},t.createElement(h,null)))):"dropdown"==i.type?t.createElement("div",{className:"flow-dropdown"},t.createElement("div",{className:"flow-select",onClick:function(){return n.setState({dropDownopen:!n.state.dropDownopen})}},t.createElement("div",{className:"flow-optTitle"},-1!=this.state.dropDownSelected&&i.options&&0!=i.options.length?i.options[this.state.dropDownSelected].title:"..."),t.createElement("div",{className:"flow-icon"},i.options&&0!=i.options.length?t.createElement(p,null):"")),t.createElement("div",{className:"flow-options flow-open"+(this.state.dropDownopen?"True":"False")},i.options.map(function(e,o){return t.createElement("div",{key:o,className:"flow-option",onClick:function(){n.updateValue(e.value),n.setState({dropDownSelected:o,dropDownopen:!1})}},t.createElement("div",{className:"flow-optTitle"},e.title),t.createElement(f,{tip:e.tooltip}))}))):""),"switch"==i.type?t.createElement(a,null):"",o?t.createElement("div",{className:"flow-error"},o):"")},o}(t.Component),w=function(e){function o(){var t;return(t=e.call(this)||this).state={hover:!1,showAddOptions:!1,showAdvanced:!1},t.remove=t.remove.bind(i(t)),t}n(o,e);var a=o.prototype;return a.remove=function(){this.props.graphInstance.props.Tree.removeComponent(this.props.graphInstance.props.data.path)},a.add=function(){1!=this.props.graphInstance.props.data.component.next.length?this.setState({showAddOptions:!0}):this.realAdd(this.props.graphInstance.props.data.component.next[0])},a.realAdd=function(t){this.setState({showAddOptions:!1}),t&&this.props.graphInstance.props.Tree.addComponent(t,this.props.graphInstance.props.data.path)},a.render=function(){var e=this,n=this.props.graphInstance.props.data;if(!n)return"";var o,i=n.component,a=i.inputs,r=i.advancedInputs;return t.createElement("div",{className:"flow-fullBlock flow-hover"+(this.state.hover&&!this.state.showAddOptions?"True":"False"),onMouseOver:function(){e.state.hover||e.setState({hover:!0})},onMouseOut:function(){e.state.hover&&e.setState({hover:!1})}},t.createElement("div",{className:"flow-side"},t.createElement("div",{className:"flow-innerSide"},t.createElement("div",{className:"flow-round",onClick:this.remove},t.createElement(l,null)))),t.createElement("div",{className:"flow-middle"},t.createElement("div",{className:"flow-title"},i.title,t.createElement(f,{transparrent:!0,tip:i.tooltip})),t.createElement("div",{className:"flow-inputs"},a.map(function(o,i){var a=n.inputData[o.name];return t.createElement(v,{refID:n.id,key:i,input:o,initalVal:a?a.value:void 0,onChange:function(t){e.props.graphInstance.props.Tree.updateInputValue(n.path,t,i,!1)}})}),r.length>0?(o=r.filter(function(t){return!0!==(!n.inputData[t.name]||!t.validation||t.validation(void 0,n.inputData[t.name].value))}).length>0&&!e.state.showAdvanced,t.createElement("div",{className:"flow-showAdvanced"},t.createElement("div",{className:"flow-button error"+(o?"True":"False"),onClick:function(){e.setState({showAdvanced:!e.state.showAdvanced},function(){e.props.graphParrentInstance?e.props.graphParrentInstance.forceUpdate():e.props.graphInstance&&e.props.graphInstance.forceUpdate()})}},o?t.createElement(d,null):"","Advanced ",t.createElement(e.state.showAdvanced?c:p,null)))):""),t.createElement("div",{className:"flow-inputs flow-advancedInputs flow-show"+(this.state.showAdvanced?"True":"False")},r.map(function(o,i){var a=n.inputData[o.name];return t.createElement(v,{hiddenDropdown:!e.state.showAdvanced,key:i,input:o,initalVal:a?a.value:void 0,onChange:function(t){e.props.graphInstance.props.Tree.updateInputValue(n.path,t,i,!0)}})}))),i.next.length>0?t.createElement("div",{className:"flow-nextOptions flow-show"+(this.state.showAddOptions?"True":"False")},t.createElement("div",{className:"flow-closePopup",onClick:function(){return e.realAdd()}},t.createElement(s,null)),t.createElement("div",{className:"flow-pos"},t.createElement("div",{className:"flow-optionsTitle"},"Options"),i.next.map(function(n,o){return t.createElement("div",{onClick:function(){return e.realAdd({componentName:n})},className:"flow-option",key:o},e.props?e.props.graphInstance.props.Logic.title(n):n)}))):"",i.next.length>0?t.createElement("div",{className:"flow-side"},t.createElement("div",{className:"flow-innerSide"},t.createElement("div",{className:"flow-round",onClick:function(){return e.add()}},t.createElement(s,null)))):"")},o}(t.Component),g=function(e){function o(){var t;return(t=e.call(this)||this).state={element:void 0,lastParentPosition:0},t.mounted=!1,t}n(o,e);var i=o.prototype;return i.componentDidMount=function(){this.mounted=!0,this.watchParent()},i.componentWillUnmount=function(){this.mounted=!1},i.watchParent=function(){var t=this;if(this.mounted){var e=this.props.connectTo,n=void 0;e&&(n=e.getBoundingClientRect()).top!=this.state.lastParentPosition&&this.setState({lastParentPosition:n.top}),setTimeout(function(){t.watchParent()},800)}},i.render=function(){var e=this,n=0,o=0,i="";if(this.props.connectTo&&this.state.element){var a=this.props.connectTo.getBoundingClientRect(),r=this.state.element.getBoundingClientRect(),s=a.y+a.height/2-(r.y+r.height/2);0==s?(n=20,o=10,i="straight"):s<0?(o=(n=20-s)-10,i="bottomToTop"):(n=s+20,o=10,i="topToBottom")}return t.createElement("div",{className:"flow-graphPart",style:{width:this.props.width}},n&&o&&i?t.createElement("div",{className:"flow-lineToParrent",style:{bottom:o+"px"}},t.createElement("svg",{viewBox:"0 0 80 "+n,height:n+"px",style:{minHeight:n+"px"},xmlns:"http://www.w3.org/2000/svg"},t.createElement("path","bottomToTop"==i?{strokeWidth:"7",stroke:"#ccc",strokeLinecap:"round",fill:"none",d:"M0,10 C70,10 30,"+(n-10)+" 80,"+(n-10)}:"topToBottom"==i?{strokeWidth:"7",stroke:"#ccc",strokeLinecap:"round",fill:"none",d:"M0,"+(n-10)+" C70,"+(n-10)+" 30,10 80,10"}:{strokeWidth:"7",stroke:"#ccc",strokeLinecap:"round",fill:"none",d:"M0,10 C70,10 30,10 80,10"}))):"",t.createElement("div",{ref:function(t){var n=e.props.connectTo,o=void 0;if(n&&(o=n.getBoundingClientRect()),"object"!=typeof e.state.element||o&&o.top!=e.state.lastParentPosition){var i={element:t};o&&(i.lastParentPosition=o.top),e.setState(i)}},className:"flow-graph",style:{minWidth:this.props.itemWidth}},t.createElement(w,{graphInstance:this,graphParrentInstance:this.props.connectToInstance})),t.createElement("div",{className:"flow-next"},this.props.data.next.map(function(n,o){return t.createElement(g,{Tree:e.props.Tree,Logic:e.props.Logic,connectTo:e.state.element,connectToInstance:e,width:e.props.width-e.props.itemWidth,itemWidth:e.props.itemWidth,key:o,data:n})})))},o}(t.Component),E=function(o){function s(){var t;return(t=o.call(this)||this).Logic=new a,t.Tree=new r(t.Logic,i(t)),t.lastlogicHash="",t.state={settings:t.Logic.get()},t}n(s,o);var l=s.prototype;return l.componentDidMount=function(){var t=this,n=e(this.props.logic);n!=this.lastlogicHash?(this.lastlogicHash=n,this.setState({settings:this.Logic.parseNewLogic(this.props.logic)},function(){return t.afterMount()})):this.afterMount()},l.afterMount=function(){"function"==typeof this.props.onChange&&this.Tree.setExportFunc(this.props.onChange),"object"==typeof this.props.flow&&this.Tree.import(this.props.flow)},l.render=function(){var e=this,n=this.state.settings;return t.createElement("div",{className:"flowMakerComp"},t.createElement("div",{className:"flowMakerContainer",style:{minWidth:250+380*this.Tree.maxDepth+"px"}},t.createElement("div",{className:"flow-row",style:{minWidth:"250px"}},n.introComponents.length>0?t.createElement("div",{className:"flow-startPoint"},t.createElement("h3",null,"Start here"),t.createElement(m,{Tree:this.Tree,Logic:this.Logic,options:n.introComponents,out:function(t){return e.Tree.startFlow(t)}})):""),t.createElement("div",{className:"flow-actualGraph",style:{width:380*this.Tree.maxDepth+"px"}},this.Tree.flow.map(function(n,o){return t.createElement(g,{Tree:e.Tree,Logic:e.Logic,width:380*e.Tree.maxDepth,itemWidth:380,key:o,data:n})}))))},s}(t.Component);export default E;
//# sourceMappingURL=flowmaker.mjs.map
